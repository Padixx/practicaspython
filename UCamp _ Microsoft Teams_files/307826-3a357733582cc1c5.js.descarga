"use strict";(this.webpackChunk_msteams_multi_window=this.webpackChunk_msteams_multi_window||[]).push([[307826],{19435:(e,t,r)=>{if(r.d(t,{zF:()=>v,db:()=>p,mM:()=>m,kh:()=>g}),740179==r.j)var i=r(361366);if(740179==r.j)var o=r(332130);if(740179==r.j)var n=r(741502);if(740179==r.j)var a=r(662239);if(740179==r.j)var s=r(289887);if(740179==r.j)var l=r(334025);if(740179==r.j)var c=r(625050);if(740179==r.j)var u=r(710141);if(740179==r.j)var d=r(72297);if(740179==r.j)var h=r(251893);if(740179==r.j)var f=r(471608);const v=(e,t)=>{let r;if(t){const i=a.Jt.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==o.Ch.Anonymous));if(i.length>1){const t=a.Jt.getValue(s.Jl.globalUser);if(r=!!e&&i.find((t=>t.id===e))||i.find((e=>e.id===t.id)),r)return r;throw{message:"Multiple users found in cache with same tenantId",errorCode:l.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return i[0]}if(e){const t=a.Jt.getAllOfType("User");r=null==t?void 0:t.filter((t=>t.id===e))[0]}else r=a.Jt.getValue(s.Jl.globalUser);return r},p=e=>{if(!e)return[];return a.Jt.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},m=(e,t,r,o)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){null==r||r.addScenarioMark("auth_get_encryption_key_start");const i=a.Jt.getValue(s.Jl.encryptionKey);if("object"==typeof i)return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),i;let n,l;null==r||r.addScenarioMark("auth_get_exported_key_start");try{if(o&&(0,h.n)(e)){const e=yield t.loadModule("auth");n=(yield e.acquireEncryptionKey({correlationId:(null==r?void 0:r.correlation.id)||(0,u.pW)()})).result}else{const e=a.Jt.getValue(s.Jl.exportedEncryptionKey);n=null==e?void 0:e.exportedKey}}catch(e){return null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),null==r||r.addScenarioMark("auth_get_encryption_key_stop"),null}if(!n)return null==r||r.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void(null==r||r.addScenarioMark("auth_get_encryption_key_stop"));try{l=yield e.crypto.subtle.importKey("raw",(0,d.k)(n),{name:"AES-CBC"},!0,["encrypt","decrypt"]),a.Jt.put(s.Jl.encryptionKey,l),null==r||r.addScenarioMark("auth_get_exported_key_stop")}catch(e){null==r||r.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),l=null}return null==r||r.addScenarioMark("auth_get_encryption_key_stop"),l})),g=(e,t,r)=>{const i=o.JE[n.j[e]],l=v(t,void 0);if(!l)return void c.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const d=(0,f.Xx)(l),h=(0,u.u4)(null==r?void 0:r.reason)||i;a.Jt.put((0,s.VF)(d).userAuthState,{state:i,reason:h,customError:r?{errorCode:r.errorCode||r.code,message:r.message,isExpected:r.isExpected,context:r.context,subContext:r.subContext,correlationId:r.correlationId}:null}),r?c.q.warn(`[AuthState] UserAuthState updated - ${t} : ${i} errorCode: ${r.errorCode} isExpected: ${r.isExpected} correlationId: ${r.correlationId}`):c.q.log(`[AuthState] UserAuthState updated - ${t} : ${i}`)}},662239:(e,t,r)=>{if(r.d(t,{Jt:()=>d,ky:()=>y}),740179==r.j)var i=r(361366);var o=r(334025);if(740179==r.j)var n=r(625050);if(740179==r.j)var a=r(710141);if(740179==r.j)var s=r(471608);if(740179==r.j)var l=r(289887);const c=[o.aw,o.ZU,o.Fz],u={KeyVersion:"v1",UseAccountIdKey:!0};let d;const h=e=>u.UseAccountIdKey?(null==e?void 0:e.id)||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),f=(e,t,r)=>`tmp.auth.${u.KeyVersion}.${e}.${t}.${r}`,v=e=>{const{typeName:t,user:r}=e;return{user:e.user?h(r):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},p=(e,t)=>({storageKey:u.UseAccountIdKey?f(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:f(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class m{constructor(e){this._expireOffsetSeconds=o.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=o.rF.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=(e,t)=>(0,i.__awaiter)(this,void 0,void 0,(function*(){let r=t;t.item.encryptedToken&&(r=this._deepCopyEncryptedToken(t));const i=v(e),{storageKey:o,loggingKey:s}=p(e,i);try{if(this._storage.setItem(o,(0,a.u4)(r)),"LogoutState"===e.typeName){const{storageKey:t}=((e,t)=>({storageKey:u.UseAccountIdKey?`$[${t.user}][${t.typeName}][${t.key}]`:f(t.user,t.typeName,t.key),loggingKey:f(e.user?`${e.user.id}`:t.user,t.typeName,t.key)}))(e,i);this._storage.setItem(t,(0,a.u4)(r))}}catch(e){n.q.error(`error in putting key [${s}] in storage, error - [${(0,a.VK)(e)}]`)}})),this._deepCopyEncryptedToken=e=>{const t=e.item,r=Object.assign({},t);return r.skypeToken?r.skypeToken="":r.token="",{item:r,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh}},this._deleteFromExternalCache=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){const t=v(e),{storageKey:r,loggingKey:i}=p(e,t);try{this._storage.removeItem(r)}catch(e){n.q.error(`error in deleting key [${i}] in storage, error - [${(0,a.VK)(e)}]`)}})),this._flushExternalCache=e=>(0,i.__awaiter)(this,void 0,void 0,(function*(){try{const t={};Object.keys(this._storage).forEach((r=>{c.forEach((e=>{if(-1!==r.indexOf(e)){const e=this._storage.getItem(r);e&&(t[r]=e)}})),(!e&&0===r.indexOf("$[")||!e&&0===r.indexOf("tmp.auth")||e&&(-1!==r.indexOf(e.oid)||e.id&&-1!==r.indexOf(e.id)))&&this._storage.removeItem(r)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){n.q.error(`error in clearing storage, error - [${(0,a.VK)(e)}]`)}})),this._isGlobalUser=e=>{var t,r;let i=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;return i||(i=this.get(l.Jl.globalUser)),i&&(0,s.FG)((0,s.Xx)(i.item),e)},this._putGlobalUserInCache=(e,t)=>{var r,i;if((null===(i=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===i?void 0:i.User)&&e.user&&!this._isGlobalUser(e.user))return;const o=e.user?"GLOBAL":h((0,s.Xx)(t.item));this._initializeCacheForCacheItem("User",o),this.internalCache[o].User.User=t;const n=u.UseAccountIdKey?f(o,"User","User"):`$[${o}][User][User]`;this._storage.setItem(n,JSON.stringify(t))},this._validateValue=(e,t)=>{var r,i;if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==o.rz||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const n=t;if(!(n.userName&&n.type&&n.role&&n.profile&&void 0!==n.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!n.userName}], type: [${n.type}], role: [${n.role}], profile exists: [${!!n.profile}],isAuthenticated: [${n.isAuthenticated}]`);const a=null===(i=null===(r=this.internalCache.GLOBAL)||void 0===r?void 0:r.User)||void 0===i?void 0:i.User,l=(0,s.Xx)(n);if(a&&!e.user&&!this._isGlobalUser(l))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,n.q.info("auth_cache initialized")}updateSetting(e,t){n.q.log(`Updating authCache setting ${e} from ${u[e]} to ${t}.`),"KeyVersion"===e&&(t!==u.KeyVersion&&(this.internalCache={}),u.KeyVersion=t),"UseAccountIdKey"===e&&(t!==u.UseAccountIdKey&&(this.internalCache={}),u.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){var r,i;g(e),this._validateValue(e,t);const{typeName:o,key:n,user:a}=v(e);("Token"===o||"Discover"===o&&"SKYPE-TOKEN"===n)&&(t.fromCache=!0);let s=null===(i=null===(r=this.internalCache[a])||void 0===r?void 0:r[o])||void 0===i?void 0:i[n];return s?(s.hitCount=0,s.item=t):s={item:t,shouldRefresh:!1,hitCount:0},"User"===o&&this._putGlobalUserInCache(e,s),this._initializeCacheForCacheItem(o,a),this.internalCache[a][o][n]=s,this._addToExternalCache(e,s),!0}updateGlobalUser(e){const t="GLOBAL",r={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache.GLOBAL.User.User=r,this._addToExternalCache(l.Jl.globalUser,r),!0}get(e){var t,r,i;g(e);const o=v(e),{storageKey:s,loggingKey:l}=p(e,o),{typeName:c,key:u,user:d}=o;let h=null===(r=null===(t=this.internalCache[d])||void 0===t?void 0:t[c])||void 0===r?void 0:r[u];const f=!!h;if(!h)try{const e=null===(i=this._storage)||void 0===i?void 0:i.getItem(s);e&&(h=JSON.parse(e))}catch(e){n.q.error(`value for key [${l}] throw error. ${(0,a.VK)(e)}`)}if(h)return this._initializeCacheForCacheItem(c,d),this.internalCache[d][c][u]=h,("Token"===c||"Discover"===c&&"SKYPE-TOKEN"===u)&&(h.shouldRefresh=this._shouldRefresh(h.item,c),h.hitCount++,this.internalCache[d][c][u]=h,this._addToExternalCache(e,h)),void 0===h.shouldRefresh?(n.q.info(`cacheItem '[${s}]' need to refresh`),void this.del(e)):(n.q.info(`returning cacheItem '[${s}]' from cache. In memory:${+f} found: [${+!!h}]`),h);n.q.info(`value for key [${l}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],r=[];return Object.keys(this.internalCache).forEach((i=>{"GLOBAL"!==i&&Object.keys(this.internalCache[i][e]||{}).forEach((o=>{const{storageKey:n}=p({},{user:i,typeName:e,key:o});r.push(n),t.push(this.internalCache[i][e][o].item)}))})),Object.keys(this._storage).forEach((i=>{var o;if(-1===r.indexOf(i)&&-1===i.indexOf(".GLOBAL.")&&-1===i.indexOf("[GLOBAL]")&&(-1!==i.indexOf(`[${e}]`)||-1!==i.indexOf(`.${e}.`)))try{const e=this._storage.getItem(i);e&&t.push(null===(o=JSON.parse(e))||void 0===o?void 0:o.item)}catch(e){n.q.error(`value for key [${i}] throw error. ${(0,a.VK)(e)}`)}})),t}del(e){var t,r,i,o;if(!e)return n.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return n.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const a=v(e),{loggingKey:s}=p(e,a),{typeName:l,key:c,user:u}=a;(null===(r=null===(t=this.internalCache[u])||void 0===t?void 0:t[l])||void 0===r?void 0:r[c])&&n.q.info(`Value of key: [${s}] exists before deletion]`);const d=(null===(o=null===(i=this.internalCache[u])||void 0===i?void 0:i[l])||void 0===o?void 0:o[c])&&delete this.internalCache[u][l][c],h=this._deleteFromExternalCache(e);return n.q.info(`deleted from local auth-cache. key: [${s}], done - local: [${d}], storage: [${h}]`),d}delTokensWithError(e,t){var r,i,o,n;const{user:a,typeName:s}=v({user:e,typeName:"Token"});if(null===(r=this.internalCache[a])||void 0===r?void 0:r[s]){const r=this.internalCache[a][s];for(const a in r)(null===(n=null===(o=null===(i=r[a])||void 0===i?void 0:i.item)||void 0===o?void 0:o.error)||void 0===n?void 0:n.errorCode)===t&&this.del({user:e,typeName:s,key:a})}}deleteType(e,t){var r;const{user:i,typeName:o}=v({user:e,typeName:t});if(null===(r=this.internalCache[i])||void 0===r?void 0:r[o]){let t;if("Token"===o)t=this.internalCache[i][o];else{if("Discover"!==o)return;t=this.internalCache[i][o]}for(const r in t)r&&this.del({user:e,typeName:o,key:r})}}flush(e){var t,r;if(!e){n.q.info("no user provided, flushing global user from cache");const i=null===(r=null===(t=this.internalCache.GLOBAL)||void 0===t?void 0:t.User)||void 0===r?void 0:r.User;if(!i)return;e=(0,s.Xx)(i.item)}n.q.info("flushing user data from cache");const i=h(e);this.internalCache[i]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),n.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){const r="Token"===t?null==e?void 0:e.expires:null==e?void 0:e.expiration,i=Math.round(Date.now()/o.rF.MILLI_PER_SECOND);let n;if(n="Discover"===t?Math.round(r/o.rF.MILLI_PER_SECOND):"Token"===t?r:void 0,e&&n){const e=n-this._expireOffsetSeconds;if(i<=n-this._expireOffsetSecondsMin)return i>=e}}}const g=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},y=e=>{var t;return d||(d=new m(e),(null===(t=e.localStorage)||void 0===t?void 0:t.getItem("localDebug"))&&e.loader&&(e.loader.authCache=d),d)}},289887:(e,t,r)=>{r.d(t,{VF:()=>o,px:()=>n,Jl:()=>a});var i=r(334025);const o=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"}}),n=(e,t,r)=>({user:e,typeName:"Token",key:`${t}${r?`-external-${r}`:""}`}),a={logoutState:{typeName:i.ZU},authSessionId:{typeName:i.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"}}},233743:(e,t,r)=>{if(r.d(t,{kj:()=>f,gA:()=>v,Zl:()=>p,fG:()=>m,Gp:()=>g,MD:()=>y,iK:()=>_,xq:()=>C,SH:()=>b,Ri:()=>x,$R:()=>S,et:()=>E}),740179==r.j)var i=r(361366);if(740179==r.j)var o=r(332130);if(740179==r.j)var n=r(902578);if(740179==r.j)var a=r(343324);if(740179==r.j)var s=r(184717);if(740179==r.j)var l=r(710141);if(740179==r.j)var c=r(449856);if(740179==r.j)var u=r(334025);if(740179==r.j)var d=r(625050);if(740179==r.j)var h=r(471608);const f=(e,t,r)=>(0,s.Tr)({context:"authentication",subContext:e,errorCode:(null==t?void 0:t.errorCode)||"ErrorCodeMissing",message:(null==t?void 0:t.errorMessage)||"ErrorMessageMissing",isExpected:null==t?void 0:t.isExpected,correlationId:r.id}),v=(e,t,r)=>{var i,o,n,a,s,l;const c=f(e,t,r);return Object.assign(Object.assign({},c),{message:c.message,stack:c.stack,errorMetaData:{accountId:null===(o=null===(i=null==t?void 0:t.result)||void 0===i?void 0:i.profile)||void 0===o?void 0:o.id,name:null===(a=null===(n=null==t?void 0:t.result)||void 0===n?void 0:n.profile)||void 0===a?void 0:a.displayName,email:null===(l=null===(s=null==t?void 0:t.result)||void 0===s?void 0:s.profile)||void 0===l?void 0:l.email}})},p=e=>{var t,r;const i=null===(t=e.extraQueryParameters)||void 0===t?void 0:t.tenantId,n=(null===(r=e.extraQueryParameters)||void 0===r?void 0:r.accountType)||o.Ch.Aad;return{tenantId:i,correlation:e.correlation,silent:e.silent,extraQueryParameters:e.extraQueryParameters,userIdentifier:{accountType:n,tenantId:i,id:e.accountId||"",userName:"",oid:""}}},m=e=>{var t;return e.accountId&&(null===(t=e.extraQueryParameters)||void 0===t?void 0:t.tenantId)},g=(e,t,r)=>{var i;return(0,s.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:t.message||"ErrorMessageMissing",isExpected:null!==(i=t.isExpected)&&void 0!==i&&i,correlationId:r.id})},y=(e,t,r)=>{const{correlation:o,userIdentifier:n}=r,a=(0,i.__rest)(r,["correlation","userIdentifier"]),c=`[webview2][${e}] result: ${(0,l.VK)(t)}, options: 'userIdentifier:${!!n},correlationId:${o.id},${(0,l.VK)(a)}'`;return(null==t?void 0:t.isExpected)?d.q.warn(c):d.q.error(c),(0,s.Tr)({context:"webview2",subContext:e,errorCode:(null==t?void 0:t.errorCode)||"ErrorCodeNotFound",message:(null==t?void 0:t.errorMessage)||c,correlationId:o.id,isExpected:null==t?void 0:t.isExpected})},_=(e,t,r)=>{const{correlation:o,userIdentifier:n}=r,a=(0,i.__rest)(r,["correlation","userIdentifier"]),c=`[webview2][${e}] error: '${(0,l.VK)(t)}', options: 'userIdentifier:${!!n},correlationId:${(null==o?void 0:o.id)||o.id},${(0,l.VK)(a)}'`;return t.isExpected?d.q.warning(c):d.q.error(c),(0,s.Tr)({context:"webview2",subContext:e,errorCode:t.errorCode,message:t.message||c,correlationId:o.id,isExpected:t.isExpected,innerError:t})},C=(e,t,r,i,o)=>{if(r.addEventData(["module_fetch"]),!e[t]){r.addEventData(["nativeApiNotAvailable"]);const e=f(`auth-webview2::_${t}`,{correlationId:o.id,errorCode:"hostCommMissing",providerErrorContext:void 0,status:n.oo.FAILED},o);throw i({error:e}),e}},b=(e,t,r)=>{var i;const{accountId:o,correlation:a,prompt:s,loginHint:l,extraQueryParameters:c,windowId:u}=e,d={accountId:o,correlationId:a.id,domainHint:(null==r?void 0:r("enableAad"))?(null==r?void 0:r("enableMultiCloud"))?void 0:n.nU.prod:n.nU.life,extraQueryParameters:(0,h.nW)(c),loginHint:l,silent:"none"===s,windowId:u};return t.addEventData([`nativeArgs:{domainPresent:${d.domainHint}`,`extraParams:${null===(i=d.extraQueryParameters)||void 0===i?void 0:i.length}`,"idPresent:"+ +!!d.accountId,"loginHintPresent:"+ +!!d.loginHint,`silent:${d.silent}}`]),d},x=(e,t,r)=>{var i;const o=S(t.userIdentifier),n={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:null!==(i=t.silent)&&void 0!==i?i:"login"!==t.prompt,userIdentifier:o,tenantId:t.tenantId,extraQueryParameters:(0,h.nW)(t.extraQueryParameters),windowId:t.windowId};return r.addEventData(["nativeArgs:{","accessTokenPresent:"+ +!!n.accessTokenToRenew,"claimPresent:"+ +(0,h.WD)(t.claim),"idPresent:"+ +!!(null==o?void 0:o.id),`silent:${n.silent}`,"userToUse:"+ +!!o,"externalTenant:"+ +!!n.tenantId,"}"]),n},S=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),E=(e,t)=>{var r;let i;d.q.info("Getting user profile");const n=null===(r=e.extendedProperties)||void 0===r?void 0:r.find((e=>"acct"===e.name));let a;n&&(i=+n.value);try{a=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch(t){a=e.profile.oid}const s=$(e,!!(null==t?void 0:t("enableMTO")),!!(null==t?void 0:t("enableCCM")));let l=1===i?o.w4.Guest:o.w4.Member;return s===o.Yf.Ccm&&(l=o.w4.Anonymous),{id:a,userName:e.userName||e.profile.email,profile:{acct:i,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,h.QG)(e.profile.tenantId),cloud:(0,h.nL)(e),homeAccountId:e.profile.isHomeAccount?a:(0,h.vt)(e),role:l,subType:s}},$=(e,t,r)=>{var i;let n=o.Yf.Default;if(t||r){const s={id:(0,l.pW)(),scenarioName:a.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"},[d,h]=(0,c.OU)({options:{correlation:s},subContext:"auth-helper::getUserSubType",scenarioName:a.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"}),f=null===(i=e.extendedProperties)||void 0===i?void 0:i.find((e=>e.name===u.GA));if(f){const e=t&&f.value.indexOf(u.f)>-1,i=r&&f.value.indexOf(u.u1)>-1;e?n=o.Yf.Mto:i&&(n=o.Yf.Ccm)}h({reason:"Extended properties wids claim check done.",userSubType:n},"success")}return d.q.log(`User subType set to ${n}, enableMTO: ${t}`),n}},251893:(e,t,r)=>{r.d(t,{n:()=>i});const i=e=>{var t;return!!(null===(t=null==e?void 0:e.chrome)||void 0===t?void 0:t.webview)}},471608:(e,t,r)=>{if(r.d(t,{b6:()=>g,yI:()=>y,B$:()=>_,vt:()=>C,LP:()=>b,QG:()=>x,nL:()=>S,Ig:()=>E,Xx:()=>I,qv:()=>k,nW:()=>w,aS:()=>U,Kv:()=>T,FG:()=>O,fM:()=>A,jV:()=>D,PU:()=>N,dW:()=>j,au:()=>q,S1:()=>L,NL:()=>P,WD:()=>R,_Z:()=>F,ps:()=>G,Fr:()=>K,N3:()=>B}),740179==r.j)var i=r(361366);var o,n=r(197981);if(740179==r.j)var a=r(332130);if(740179==r.j)var s=r(193022);if(740179==r.j)var l=r(343324);if(740179==r.j)var c=r(625050);if(740179==r.j)var u=r(334025);if(740179==r.j)var d=r(662239);if(740179==r.j)var h=r(184717);if(740179==r.j)var f=r(710141);if(740179==r.j)var v=r(289887);if(740179==r.j)var p=r(19435);if(740179==r.j)var m=r(233743);!function(e){e.Otp="mail",e.GFed="google.com"}(o||(o={}));const g=e=>(c.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(u.uI.FIFTEEN)/u.rF.MILLI_PER_SECOND),fromCache:!0}),y=(e,t,r)=>{if(e===a.G7.prod||e===a.G7.life)return"";const i=null==r?void 0:r("instanceUrl"),o=i?`${i}${null!=t?t:"common"}`:"";return c.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${o}`),o},_=(e,t,r,i)=>{const o=(null==t?void 0:t.profile.tid)||r||(null==e?void 0:e.tenantId);if(o&&(t||i||(null==e?void 0:e.isAnonEligible)&&(null==e?void 0:e.isAnonRestrictionSatisfied)))return b(o,t)},C=e=>{const t=e.homeAccountId;return null==t?void 0:t.split(".")[0]},b=(e,t)=>{var r;c.q.info("Anon flow - anonymous user created");const i=e===u.zP;return{id:M,isAuthenticated:!0,userName:(null==t?void 0:t.userName)||"anonymous",profile:{oid:k(e),tid:e,upn:(null===(r=null==t?void 0:t.profile)||void 0===r?void 0:r.upn)||"",puid:""},role:a.w4.Anonymous,type:a.Ch.Anonymous,homeAccountId:M,cloud:(null==t?void 0:t.cloud)||(i?a.G7.life:a.G7.prod),subType:a.Yf.Default}},x=e=>e===s.e0?a.Ch.MsaLife:a.Ch.Aad,S=e=>{if(x(e.profile.tenantId)===a.Ch.MsaLife)return a.G7.life;switch(e.profile.sovereignty){case a.ym.prod:return a.G7.prod;case a.ym.gcch:return a.G7.gcch;case a.ym.dod:return a.G7.dod;case a.ym.gallatin:return a.G7.gallatin;default:return a.G7.prod}},E=(e,t,r,i)=>{var l,d,h,f,v,p;if((null==t?void 0:t.subType)===a.Yf.Ccm)return t;if(!t||(0,n.isEmpty)(t.profile)||t.role===a.w4.Anonymous||t.userRole===u.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&i)return c.q.info("checking anon flow"),_(e,t,r,i);t.role=1===(null===(l=t.profile)||void 0===l?void 0:l.acct)?a.w4.Guest:a.w4.Member;let m=0===(null===(h=null===(d=t.profile)||void 0===d?void 0:d.altsecid)||void 0===h?void 0:h.indexOf("1:"))?a.Ch.Msa:a.Ch.Aad;return(null===(f=t.profile)||void 0===f?void 0:f.idp)&&(null===(v=t.profile)||void 0===v?void 0:v.iss)!==t.profile.idp?(m=t.profile.idp===o.Otp?a.Ch.Otp:m,m=t.profile.idp===o.GFed?a.Ch.GFed:m):(null===(p=t.profile)||void 0===p?void 0:p.tid)===s.e0&&(m=a.Ch.MsaLife),$(t,m)},$=(e,t)=>(e.type=t,e.profile.oid=e.profile.oid||k(e.profile.tid),e.cloud||(e.cloud=e.type===a.Ch.MsaLife?a.G7.life:a.G7.prod),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=a.Yf.Default),c.q.info(`User role = [${e.role}], type = [${t}]`),e),I=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},k=e=>`8:defaultOid:${e}`,M="anonAccountId",w=e=>{const t=[];for(const r in e)Object.hasOwnProperty.call(e,r)&&e[r]&&t.push({name:r,key:r,value:"string"==typeof e[r]?e[r]:(0,f.u4)(e[r])});return t},U=(e,t)=>{var r;t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const i=(0,p.zF)(e,void 0);if(i)return t.addScenarioMark("auth_update_global_user_foundUser"),d.Jt.updateGlobalUser(i);throw t.addScenarioMark("auth_update_global_user_noUserFound"),o=null===(r=t.correlation)||void 0===r?void 0:r.id,(0,h.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:o,errorCode:u.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"});var o},T=e=>e?(null==e?void 0:e.id)?null==e?void 0:e.id:`${null==e?void 0:e.oid}-${null==e?void 0:e.tenantId}`:"unknown user",O=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),A=(e,t,r)=>{var i;const o=new CustomEvent(t,{detail:r});null===(i=null==e?void 0:e.dispatchEvent)||void 0===i||i.call(e,o)},D=(e,t,r,i,o)=>{const n=E(e,t,i,o);return n&&(c.q.info(`[auth-helper][getMappedUserAndSetItToCache][${r}] put user in cache.`),d.Jt.put((0,v.VF)(I(n)).user,n)),n},N=(e,t,r,i)=>{if(u.s9(e))throw i.addEventData(["scope_invalid:1"]),c.q.warn(`[core-auth-base][acquireToken][${r.source}][${r.id}] invalid scope. resource: [${e}]`),(0,h.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${null==t?void 0:t.id}-${null==t?void 0:t.oid}-${null==t?void 0:t.tenantId}] sent from invalid resource: ${e}`,errorCode:u.SM.InvalidScopeResource,isExpected:!0,correlationId:r.id})},j=(e,t,r,i,o)=>(i.push("user_missing"),(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UserNotFoundError,isExpected:r,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:o})),q=(e,t,r,i)=>(0,h.Tr)({context:"core-auth-base",subContext:e,errorCode:u.SM.UnsupportedParameter,isExpected:r,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:i});const L=(e,t,r,i,o,n)=>{var a,s;null==i||i.push(`errorCode:${(null==t?void 0:t.errorCode)||"undefined"},errorMessage:${(null==t?void 0:t.message)||"undefined"}`),i&&i.length>0&&i.push("$");const l=function(e,t,r="",i,o){return{contentType:r,context:"core-auth-base",correlationId:null==t?void 0:t.correlationId,endpointUrl:o||"unset",errorCode:(null==t?void 0:t.errorCode)||"AcquireToken Error",innerError:t,isExpected:null==t?void 0:t.isExpected,message:(0,f.VK)(t),reason:(null==i?void 0:i.join(";"))||"",subContext:e}}(e,t,o,i,n),d=l.errorCode.includes(u.SM.InvalidScopeResource)||(null===(a=l.message)||void 0===a?void 0:a.includes(u.SM.InvalidScopeResource))||l.isExpected||(null===(s=l.innerError)||void 0===s?void 0:s.isExpected);return d?c.q.warning(`Error found ${(0,f.VK)(t)}`):c.q.error(`Error found ${(0,f.VK)(t)}`),d?null==r||r.incomplete(l):null==r||r.fail(l),l},P=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),R=e=>!(!e||e===P),F=(e,t,r,i,o)=>{var n,a,s,l;return r.tflClaim&&(r.accessTokenToRenew=r.tflClaim),void 0===r.prompt&&void 0===r.silent&&(!r.accessTokenToRenew&&!R(r.claim)||(null==i?void 0:i("disablePromptFor401"))&&!((e,t)=>{const r=(null==t?void 0:t("enablePromptResourcesFor401"))||[];return!(!e||!r)&&Array.isArray(r)&&r.findIndex((t=>e.includes(t)))>-1})(e,i)?(r.prompt="none",r.silent=!0):(r.prompt="login",r.silent=!1)),o&&!r.accessTokenToRenew&&(r.forceRenew||!1===r.silent||"login"===r.prompt)&&(c.q.info("[core-auth-base][acquireToken] force renewing."),r.accessTokenToRenew=o.item.token),t.addEventData(["cacheToken:"+ +!!o,"tflClaim:"+ +!!r.tflClaim,"accessTokenToRenew:"+ +!!r.accessTokenToRenew,"forceRenew:"+ +!!r.forceRenew,`prompt: ${r.prompt}`,"silent:"+ +!!r.silent]),(null===(a=null===(n=null==o?void 0:o.item)||void 0===n?void 0:n.error)||void 0===a?void 0:a.errorCode)&&t.addEventData([`errorInToken:[${(null===(l=null===(s=null==o?void 0:o.item)||void 0===s?void 0:s.error)||void 0===l?void 0:l.errorCode)||""}]`]),r},G=(e,t,r,o,n,s)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const i=null==s?void 0:s("buildCloud"),l=null==s?void 0:s("enableMultiCloud"),u=null==s?void 0:s("enableCCM");if(c.q.log(`starting cloud misMatch check. Env: ${r}, buildCloud: ${i}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),!e.cloud||!i||e.cloud===i)return c.q.log("No cloud mismatch detected."),t.addEventData(["cloudMismatch:0"]),e;if(t.addEventData(["cloudMismatch:1","enableCCM:"+ +!!u,"meetingDetails:"+ +!!n.meetingDetails]),u&&n.meetingDetails){t.addScenarioMark("ccm_flow_start");try{const r=yield o.acquireToken("https://api.spaces.skype.com",{correlation:n.correlation,silent:n.silent,userIdentifier:I(e),tenantId:n.meetingDetails.tenantId});if(null==r?void 0:r.account){t.addEventData(["account:1"]);const e=(0,m.et)(r.account,s);if(e.subType===a.Yf.Ccm)return t.addEventData(["ccmUser:1"]),e.id=`${e.id}_${n.meetingDetails.conversationId}`,e.type=a.Ch.Anonymous,d.Jt.put((0,v.VF)(I(e)).meetingDetails,n.meetingDetails),t.addScenarioMark("ccm_flow_end"),e;t.addEventData(["ccmUser:0",`sub:${e.subType}`])}t.addScenarioMark("ccm_flow_end")}catch(e){t.addScenarioMark("ccm_flow_end",e)}}if(l){t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, enableMultiCloud: ${l}, buildCloud: ${i}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`});const a=yield V(e,n.correlation.id,o);return Promise.reject(a)}throw d.Jt.del({user:I(e),typeName:"User"}),t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${r}, buildCloud: ${i}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`}),new Error("cloud mis-match... reboot required")})),K=(e,t,r)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){return new Promise((o=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){if(e.length<=0)return o({count:0,failure:[]});let i=0;const n=[];for(const a of e){i++;try{const r=t(a);yield r,i>=e.length&&o({count:i,failure:n})}catch(t){n.push(i),null==r||r(t,i,a),i>=e.length&&o({count:i,failure:n})}}}))))})),V=(e,t,r)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){var i;const o={id:t,scenarioName:l.RG.AuthWebLogin,source:"core-auth::login"},n=(yield null===(i=r.getUserImage)||void 0===i?void 0:i.call(r,{id:e.id,correlation:o}))||"",a={cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:n};return(0,h.MD)({errorMetaData:a,authSubErrorCode:"MultiCloudMismatch",name:u.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t,errorCode:u.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0})})),B=(e,t,r,i)=>{R(r)&&e.addEventData([`isSameToken: ${i===t.token}`]);const o=(e=>{const t=(e-Math.floor((new Date).getTime()/u.rF.MILLI_PER_SECOND))*u.rF.MILLI_PER_SECOND/u.rF.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${o}`,`fromCache: ${t.fromCache}`])}},72297:(e,t,r)=>{r.d(t,{z:()=>o,k:()=>n});var i=r(86048);const o=e=>i.Buffer.from(e).toString("base64"),n=e=>i.Buffer.from(e,"base64")},307826:(e,t,r)=>{if(r.d(t,{g:()=>f}),740179==r.j)var i=r(332130);if(740179==r.j)var o=r(184717);if(740179==r.j)var n=r(710141);if(740179==r.j)var a=r(471608);var s=r(334025);if(740179==r.j)var l=r(625050);if(740179==r.j)var c=r(591277);let u,d,h;function f(e,t,r,i){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{h=!0},disable:()=>{h=!1},setConfig:v}}),function(e,t){u||(u={});u[t]=e}(e,t),h=i,h){try{d="string"==typeof r?Object.assign(Object.assign({},d),JSON.parse(decodeURIComponent(r))):Object.assign(Object.assign({},d),r)}catch(e){l.q.warning(`[MOCK-API] cannot parse config: ${r}`)}p(e,t)}else d={}}function v(e,t={}){d||(d={}),d[e]=t;const r=e.split(".")[0];p(null==u?void 0:u[r],r)}function p(e,t){Object.getOwnPropertyNames(d).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((r=>{var i,a;const s=(null===(i=Object.getOwnPropertyDescriptor(e,r))||void 0===i?void 0:i.value)||(null===(a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),r))||void 0===a?void 0:a.value);Object.defineProperty(e,r,{configurable:!0,value:(...i)=>h?(l.q.warning(`[MOCK-API] returning mocked response for ${t}.${r}`),function(e,t){var r;const i=null==d?void 0:d[`${e}.${t}`];if(i&&i.error)throw function(e,t,r){return(0,o.MD)({name:(null==e?void 0:e.name)||"",context:(null==e?void 0:e.context)||t,subContext:(null==e?void 0:e.subContext)||r,reason:null==e?void 0:e.reason,errorCode:(null==e?void 0:e.errorCode)||"ErrorCodeNotFound",correlationId:(null==e?void 0:e.correlationId)||(0,n.pW)(),isExpected:(null==e?void 0:e.isExpected)||!1,message:(null==e?void 0:e.message)||`[MockApi][${t}][${r}]`,authSubErrorCode:null==e?void 0:e.authSubErrorCode,errorMetaData:null==e?void 0:e.errorMetaData,serverResponse:null==e?void 0:e.serverResponse})}(i.error,e,t);if(i&&i.success){const e=function(e){switch(e){case"aquireToken":return g;case"user":return m();case"hostMachineUsers":return[y];case"users":return[m()];case"emptyList":return[]}return{}}(i.success.defaultValue);return Array.isArray(e)?i.success.returnValue?Array.isArray(i.success.returnValue)?[...e,...i.success.returnValue]:[...e,i.success.returnValue]:e:Object.assign(Object.assign({},e),null===(r=i.success)||void 0===r?void 0:r.returnValue)}return}(t,r)||s.apply(e,i)):s.apply(e,i)})}))}const m=()=>(0,a.Ig)(new c.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:i.w4.Member,profile:{name:"Test",oid:(0,a.qv)("123456789"),tid:"123456789"}}),g={token:"TestToken",expires:Date.now()+s.rF.SECONDS_FIVE_MINUTES,fromCache:!1},y={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},591277:(e,t,r)=>{if(r.d(t,{N:()=>n,j:()=>c}),740179==r.j)var i=r(334025);if(740179==r.j)var o=r(625050);class n{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const r=e.replace(/\+/g," ").split("=");let i=r.shift();const n=r.length>0?decodeURIComponent(r.join("=")):null;if(i){if(i=decodeURIComponent(i),"context"===i&&0===(null==n?void 0:n.indexOf("{")))try{const e=JSON.parse(n);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t=Object.assign(Object.assign({},t),e)}catch(e){o.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,i))Array.isArray(t[i])?t[i].push(n):t[i]=[t[i],n];else{t[i]=n;const e=i.toLowerCase();!n||"tid"!==e&&"tenantid"!==e||(this._tid=n)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const r=this._hash.indexOf("?");r>=0&&(this._search=this._hash.substr(r))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=a(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?i.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}}const a=e=>{if(!l)return[!1,!1];for(const t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,s(t,e.href)];return[!1,!1]},s=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const r of e.restrictions)if(t.indexOf(r)>-1)return!0;return!1};let l=740179==r.j?[]:null;const c=e=>{e&&(l=e)}},902578:(e,t,r)=>{var i,o,n,a;r.d(t,{oo:()=>i,nU:()=>o,O3:()=>a}),function(e){e.SUCCESS="SUCCESS",e.CANCELLED="CANCELLED",e.FAILED="FAILED",e.TIMEOUT="TIMEOUT"}(i||(i={})),function(e){e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap08="airgap08",e.airgap09="airgap09"}(o||(o={})),function(e){e.Aad="Aad",e.MsaLife="MsaLife"}(n||(n={})),function(e){e.AADReconnecting="AADReconnecting",e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.SignInRestriction="SignInRestriction",e.SkypeReconnecting="SkypeReconnecting",e.Up="Up"}(a||(a={}))},625050:(e,t,r)=>{r.d(t,{q:()=>o});var i=r(193022);const o=new class{constructor(){this.logLevel=i.in.Info,this.localCallback=void 0,this.error=e=>this.logMessage(i.in.Error,e),this.warning=e=>this.logMessage(i.in.Warning,e),this.warn=e=>this.logMessage(i.in.Warning,e),this.info=e=>this.logMessage(i.in.Info,e),this.log=e=>this.logMessage(i.in.Info,e),this.verbose=e=>this.logMessage(i.in.Verbose,e),this.debug=e=>this.logMessage(i.in.Verbose,e)}initialize(e,t=i.in.Verbose){this.localCallback=e,this.logLevel=t}executeCallback(e,t){this.localCallback?this.localCallback(e,t):console&&console.log(t)}logMessage(e,t){if(e>this.logLevel)return;const r=`[Auth]: ${t}`;this.executeCallback(e,r)}}},274895:(e,t,r)=>{r.d(t,{n:()=>i});class i{}i._authTelemetryCollection={},i._correlationMap={},i._userBiServiceMap={},i.getUserBiService=e=>i._userBiServiceMap[e]||i._userBiServiceMap.GLOBAL,i.setUserBiService=(e,t)=>{t?i._userBiServiceMap[e]=t:delete i._userBiServiceMap[e]},i.getAuthTelemetry=e=>i._authTelemetryCollection[e],i.setAuthTelemetry=(e,t)=>i._authTelemetryCollection[e]=t,i.delete=e=>{delete i._authTelemetryCollection[e];const t=Object.keys(i._correlationMap);for(const r in t)if(i._correlationMap.hasOwnProperty(t[r])){const o=t[r],n=i._correlationMap[o];n&&(i._correlationMap[o]=n.filter((t=>t!==e)))}},i.getCorrelation=e=>i._correlationMap[e],i.setCorrelation=e=>{const t=i.getCorrelation(e.scenarioName)||[];-1===t.indexOf(e.id)&&t.push(e.id),i._correlationMap[e.scenarioName]=t}},449856:(e,t,r)=>{if(r.d(t,{u:()=>c,OU:()=>u,ld:()=>h,cv:()=>f,Tu:()=>v}),740179==r.j)var i=r(361366);if(740179==r.j)var o=r(625050);if(740179==r.j)var n=r(710141);if(740179==r.j)var a=r(652075);if(740179==r.j)var s=r(274895);class l{constructor(e,t,r){this._scenarioProvider=e,this._authCache=t,this._telemetryService=r,this.create=e=>this._createScenario(e,!0),this.createNew=e=>{var t;const r=new a.q(this._scenarioProvider,e.correlation,this._authCache,e.subContext,!0,null!==(t=e.isBatch)&&void 0!==t&&t,e.timeoutMs,this._telemetryService);return e.scenarioEventData&&r.appendScenarioEventData(e.scenarioEventData),r},this.createWithoutScenario=e=>this._createScenario(e,!1),this.getCorrelation=e=>s.n.getCorrelation(e)||[],this._createScenario=(e,t)=>{var r,i;const{correlation:o,subContext:n,scenarioEventData:l,timeoutMs:c,scenario:u,isBatch:d}=e;let h=s.n.getAuthTelemetry(o.id);if(h)h.addEventData([`fn:${n}`]);else{const l=null===(r=this._telemetryService)||void 0===r?void 0:r.getTelemetryServicesCache().get(null===(i=e.scenarioEventData)||void 0===i?void 0:i.accountId);h=new a.q((null==l?void 0:l.coreScenarioFactory)||this._scenarioProvider,o,this._authCache,n,t,null!=d&&d,c,(null==l?void 0:l.telemetryService)||this._telemetryService,u),s.n.setAuthTelemetry(o.id,h)}return l&&h.appendScenarioEventData(l),s.n.setCorrelation(o),h}}}const c=(e,t)=>{s.n.setUserBiService(e||"GLOBAL",t)},u=e=>{var t,r,o,a,s,l;e.options.correlation={id:null!==(r=null===(t=e.options.correlation)||void 0===t?void 0:t.id)&&void 0!==r?r:(0,n.pW)(),scenarioName:null!==(a=null===(o=e.options.correlation)||void 0===o?void 0:o.scenarioName)&&void 0!==a?a:e.scenarioName,source:null!==(l=null===(s=e.options.correlation)||void 0===s?void 0:s.source)&&void 0!==l?l:e.source};const{options:{correlation:c}}=e,u=(0,i.__rest)(e,["options"]);return d(Object.assign({correlation:c},u))},d=e=>{const{correlation:t,subContext:r,scenarioEventData:i,eventData:o,timeoutMs:n,scenario:a,isBatch:l}=e,c=s.n.getAuthTelemetry(t.id),u=(e.startWithoutScenario?f.createWithoutScenario:f.create)({correlation:t,subContext:r,scenarioEventData:i,timeoutMs:n,scenario:a,isBatch:l});o&&u.addEventData(o);return[u,(e,t)=>u.closeScenario(e,t,!!c)]},h=e=>f.getCorrelation(e);let f;const v=(e,t,r)=>{f||(f=new l(e,t,r),o.q.log("authTelemetryProvider initialized"))}},652075:(e,t,r)=>{if(r.d(t,{q:()=>c}),740179==r.j)var i=r(585478);if(740179==r.j)var o=r(625050);if(740179==r.j)var n=r(710141);if(740179==r.j)var a=r(962687);if(740179==r.j)var s=r(184717);if(740179==r.j)var l=r(274895);class c{constructor(e,t,r,c,u,d,h,f,v){this._scenarioFactory=e,this._correlation=t,this._authCache=r,this._subContext=c,this._shouldCreateScenario=u,this._isBatch=d,this._timeoutMs=h,this._telemetryService=f,this._eventData=[],this._localScenarioEventData={},this._loggingPrefix="",this.appendScenarioEventData=e=>{this._scenario&&this._scenario.appendEventData(e),this._localScenarioEventData=Object.assign(Object.assign({},this._localScenarioEventData),e)},this.addEventData=e=>{Array.prototype.push.apply(this._eventData,e)},this.getEventData=()=>[...this._eventData],this.addScenarioMark=(e,t={},r)=>{t=this._mapEventData(t,r),this._scenario?this._scenario.mark(e,t,t.status):this.addEventData([`${e}:${t.status}`]),o.q.log(`${this._loggingPrefix} [${e}][${t.status}][scenarioEventData][${(0,n.u4)(t)}]`)},this.closeScenario=(e={},t,r)=>{var i;if(e=this._mapEventData(e,t),r)return e.reason&&this.addEventData([`reason:${e.reason}`]),e.errorCode&&this.addEventData([`errorCode:${e.errorCode}`]),void this.addEventData([`${this._subContext}$:${e.status}`]);if(this._isBatch&&(this._batchScenarioStartTime&&(e.perfDelta=performance.now()-this._batchScenarioStartTime),e.correlationId=null!==(i=e.correlationId)&&void 0!==i?i:this._correlation.id,"success"===e.status?(0,a.ft)(this._scenarioFactory,this._authCache,this._correlation.scenarioName,e):"failure"===e.status?(0,a.EJ)(this._scenarioFactory,this._authCache,this._correlation.scenarioName,e):(0,a.vB)(this._scenarioFactory,this._authCache,this._correlation.scenarioName,e)),!this._scenario){const t=this._shouldCreateScenario?o.q.warn:o.q.log,r=this._shouldCreateScenario?"[N/A]":"";return this.logEventData(t,`${this._loggingPrefix} [stop]${r} [scenarioEventData]`,e),void l.n.delete(this._correlation.id)}switch(e.status){case"incomplete":this._scenario.incomplete(e);break;case"failure":this._scenario.fail(e);break;case"abandoned":this._scenario.cancel(e);break;default:this._scenario.stop(e)}const n="failure"===e.status?o.q.error:o.q.log;this.logEventData(n,`${this._loggingPrefix} [stop][${e.status}] [e]`,e),l.n.delete(this._correlation.id)},this.createScenario=(e,t,r)=>{this._scenario?o.q.warn(`createScenario called with [${this._subContext}][${(0,n.u4)(this._correlation)}]::${e}, but there is already a scenario with that correltion id`):(this._createScenario(e,r||this._timeoutMs,Object.assign(Object.assign({},this._localScenarioEventData),t)),o.q.log(`${this._loggingPrefix} [create] - scenario created`))},this.recordAuthUserBiTelemetry=(e,t)=>{const r={panelRegion:i.Ai.main,panelType:i.wh.AuthStart,actionWorkload:i.sz.auth,actionSubworkload:i.eD.sisu,actionScenarioType:i.Yu.appAuth,actionScenario:t.scenario,actionGesture:t.actionGesture||i.uS.auto},n=l.n.getUserBiService(e||"GLOBAL");n&&n.recordPanelAction(r,o.q)},this.setUserToTelemetryContext=e=>{var t,r,i,o,n,a;if(e){const{id:s,oid:l,tid:c,type:u,role:d,subType:h}=e;void 0!==s&&(null===(t=this._telemetryService)||void 0===t||t.setCoreContext("userId",s===l?"":s)),void 0!==l&&(null===(r=this._telemetryService)||void 0===r||r.setCoreContext("UserInfo.Id",l)),void 0!==c&&(null===(i=this._telemetryService)||void 0===i||i.setCoreContext("UserInfo.TenantId",c)),void 0!==u&&(null===(o=this._telemetryService)||void 0===o||o.setCoreContext("UserInfo.Type",u)),void 0!==d&&(null===(n=this._telemetryService)||void 0===n||n.setCoreContext("UserInfo.Role",d)),void 0!==h&&(null===(a=this._telemetryService)||void 0===a||a.setCoreContext("UserInfo.SubType",h)),this.addScenarioMark(`${this._correlation.scenarioName}_set_user_on_telemetry_context`)}},this.setUserDetailsToTelemetryContext=e=>{var t;if(e){const{region:r}=e;void 0!==r&&(null===(t=this._telemetryService)||void 0===t||t.setCoreContext("UserInfo.Region",r)),this.addScenarioMark(`${this._correlation.scenarioName}_set_tenant_details_on_telemetry_context`)}},this._mapEventData=(e,t)=>{var r,i;return e.subContext=e.subContext||this._subContext,(e=Object.assign(Object.assign({},this._localScenarioEventData),e)).error&&(e.error=Object.assign(Object.assign({},e.error),{stack:this.scrubQsString("loginHint",e.error.stack),message:e.error.message,errorMetaData:void 0}),e.message=`[message]${null!==(r=e.message)&&void 0!==r?r:""} [errorMessage]${e.error.message}`,e.errorCode=null!==(i=e.error.code)&&void 0!==i?i:e.error.errorCode,this.addEventData([`errorCode:${e.error.errorCode}`])),!t&&e.error&&(t=(0,s.ZG)(e.error)?"incomplete":"failure"),e.eventData=this._eventData.join(","),e.status=t||"success",e},this._createScenario=(e,t,r)=>{var i,n,a;const s=t?{timeoutMs:t}:{};this._scenario=null!==(i=this._scenarioFactory.findScenario(e))&&void 0!==i?i:this._scenarioFactory.newScenario(e,s);try{null===(a=(n=this._scenarioFactory).hoistScenarioToCore)||void 0===a||a.call(n,this._scenario)}catch(e){o.q.log(`${this._loggingPrefix} ${e.message}`)}this._scenario.appendEventData(Object.assign({secondaryCorrelationId:this._correlation.id,commandSource:this._correlation.source},r)),this._shouldCreateScenario=!0},this.loggingPrefix=()=>`[Telemetry][${this._correlation.id}][${this._correlation.scenarioName}]`,this.logEventData=(e,t,r)=>{r.error||delete r.error;const i=this.splitStringEqually((0,n.u4)(r));for(const r of i)e(`${t}${r}`)},this.splitStringEqually=(e,t=300)=>{const r=new RegExp(`.{1,${t}}`,"g"),i=e.match(r);return i||[]},this.scrubQsString=(e,t)=>{if(!t)return"";const r=new RegExp(`${e}=[^?&:)]*`,"gi");return t.replace(r,"scrubbed")},this._loggingPrefix=this.loggingPrefix(),this._isBatch&&(this._batchScenarioStartTime=performance.now()),u&&(v?this._scenario=v:this._createScenario(this._correlation.scenarioName,this._timeoutMs,void 0)),o.q.log(`${this._loggingPrefix} [start] - telemetry provider created for ${this._subContext}, source: ${this._correlation.source} with shouldCreateScenario: [${u}]`),o.q.log(`Auth cache defined: ${!!this._authCache}, is batch: ${this._isBatch}`),this._eventData.push(`^source:${this._correlation.source},fn:${this._subContext}`)}get correlation(){return Object.assign({},this._correlation)}}},962687:(e,t,r)=>{if(r.d(t,{ft:()=>s,EJ:()=>l,vB:()=>c,mM:()=>u}),740179==r.j)var i=r(361366);if(740179==r.j)var o=r(625050);if(740179==r.j)var n=r(710141);const a="batch_";function s(e,t,r,i){d(e,t,r,i,(e=>(e.successMetaData=p(i,e.successMetaData),e.successMetaData.batchScenarioCounter)))}function l(e,t,r,i){d(e,t,r,i,(e=>(e.failureMetaData=p(i,e.failureMetaData),e.failureMetaData.batchScenarioCounter)))}function c(e,t,r,i){d(e,t,r,i,(e=>(e.abandonedMetaData=p(i,e.abandonedMetaData),e.abandonedMetaData.batchScenarioCounter)))}const u=(e,t,r)=>(0,i.__awaiter)(void 0,void 0,void 0,(function*(){const i=v(t,r);if(!i)return;const o=t.getValue(i);for(const t in o)if(o[t]){const i=o[t];h(e,t,i,r)}t.del(i)}));function d(e,t,r,i,n){var s;const{accountId:l}=i,c=v(t,l);if(!c)return;const u=t.getValue(c),d=null!==(s=null==u?void 0:u[a+r])&&void 0!==s?s:{};n(d)>=1e3?(h(e,r,d,l),function(e,t,r){try{const i=a+r;o.q.log(`[clearBatchScenarioFromCache] scenario: ${i}`);const n=e.getValue(t);null==n||delete n[i],e.put(t,n)}catch(e){o.q.log(`[clearBatchScenarioFromCache] ${null==e?void 0:e.message}`)}}(t,c,r)):function(e,t,r,i){try{const o=a+r;let n=e.getValue(t);n?n[o]=i:n={[o]:i},e.put(t,n)}catch(e){return o.q.log(`[setBatchScenarioToAuthCache] ${null==e?void 0:e.message}`),!1}}(t,c,r,d)}function h(e,t,r,i){(null==r?void 0:r.successMetaData)&&f(e,t,r.successMetaData,"success",i),(null==r?void 0:r.failureMetaData)&&f(e,t,r.failureMetaData,"failure",i),(null==r?void 0:r.abandonedMetaData)&&f(e,t,r.abandonedMetaData,"abandoned",i)}function f(e,t,r,i,s){const l=a+t,c=e.newScenario(l),u=(0,n.pW)();o.q.log(`[sendBatchScenario] for ${l}, status: ${i}, correlationId:${u}`);const d={accountId:s,context:"auth-telemetry-helper",secondaryCorrelationId:u,batchScenarioData:r};switch(i){case"success":c.stop(d);break;case"failure":c.fail(d);break;default:c.cancel(d)}}function v(e,t){let r;if(t){const i=e.getAllOfType("User");r=null==i?void 0:i.filter((e=>e.id===t))[0]}else r=e.getValue({typeName:"User"});if(!r)return void o.q.log("[getBatchCacheKeyForUser] no user found in cache");return{user:{tenantId:r.profile.tid,oid:r.profile.oid,accountType:r.type,userName:r.userName,id:r.id},typeName:"BatchScenario"}}function p(e,t){return t?(t.batchScenarioCounter++,t.batchEventData.push(e)):t={batchScenarioCounter:1,batchEventData:[e]},t}},710141:(e,t,r)=>{r.d(t,{u4:()=>o,VK:()=>n,pW:()=>l});const i=globalThis;function o(e,t){const r=new WeakSet;return JSON.stringify(e,((e,t)=>{if(!r.has(t)){if(t&&"object"==typeof t){if(r.add(t),t instanceof Map||t instanceof Set)return Array.from(t);if(null==t?void 0:t.errorCode)return t;if(t instanceof Error)return`${t.name}: ${t.message}`;if(t.constructor&&t.constructor!==Object&&t.constructor!==Array||t.prototype)return}return t}}),t)}function n(e,t=!0){if(null==e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,s(a(t)))}catch(e){return"Stringifying error failed"}}const a=(e=!0)=>(t,r)=>{if(r instanceof Error){const t={};return Object.getOwnPropertyNames(r).forEach((i=>{"stack"===i?e||(t[i]=("string"==typeof r.stack?r.stack:"").split("\n").map((e=>e.trim())).filter((e=>!!e))):t[i]=r[i]})),t}return r},s=e=>{const t=new WeakSet;return(r,i)=>{if("object"==typeof i&&null!==i){if(t.has(i))return;t.add(i)}return e(r,i)}},l=()=>{try{const e=i.msCrypto||i.crypto;return`${[1e7]}-1000-4000-8000-100000000000`.replace(/[018]/g,(t=>(t^e.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}catch(e){const t="xxxxxxxx-xxxx-8xxx-yxxx-xxxxxxxxxxxx",r="0123456789abcdef";let i=0,o="";for(let e=0;e<36;e++)"-"!==t[e]&&"4"!==t[e]&&(i=16*Math.random()|0),"x"===t[e]?o+=r[i]:"y"===t[e]?(i&=3,i|=8,o+=r[i]):o+=t[e];return o}}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/307826-3a357733582cc1c5.js.map